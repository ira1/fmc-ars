<% logger.info("show.js.erb is running") %>

// Highcharts Outputs

// Show & Hide GenreIncome Output based on controller's visibility indicator
if ("true"==="<%= @genre_income_on.to_s -%>") {
  $("#genreincome").slideDown(); // anti-genre =0, genre = 1
  $('#genreincomechart').highcharts().series[0].setData(
		<%= if @antigenre_pcts then @antigenre_pcts.map {|x| number_with_precision(x,:precision=>2,:significant=>true).to_f}.to_json.html_safe else [] end %>,
		 true);
	$('#genreincomechart').highcharts().series[1].setData(
		<%= if @genre_pcts then @genre_pcts.map {|x| number_with_precision(x,:precision=>2,:significant=>true).to_f}.to_json.html_safe else [] end  %>,
		true);
} else {
  $("#genreincome").slideUp();
}
if ("true"==="<%= escape_javascript ( @genre_bar_on.to_s) %>") {
  $('#genresingroup').slideDown();
	$('#genresingroupchart').highcharts().series[0].setData(<%= @GenreSeries.to_json.html_safe %>, true);
} else {
  $("#genresingroup").slideUp();
}
  //$('#concentrationmap').highcharts().setData([] , true);
  //$('#annincbycat').highcharts().series[0].setData([]);

// % of sample output
$('.total_n_count_from_ajax').html("<%= number_with_delimiter(@NCount, :delimiter => ',') %>");
$('.total_pct_from_ajax').html("<%= @NCount_pct %>");
$('#sample_size_progressbar').animate({width: "<%= @NCount_pct %>%"});

// % of this group have 16+ years of experience
$('#aboutpctexperiencedtxt').html("<%= @AboutPctExperienced %>");
$('#pctfulltimetxt').html("<%= @pctfulltime %>");

// Avg Ann Income from music/ EMI
$('#aveannincheader').html("<%= number_to_currency(@avg_emi, :precision=>0) %>"); <%# avg ann inc for sample %>
$('#aveannincheader').attr("title","<%= @emi_pct_answered %>% of respondents in filtered sample provided EMI");
$('#aveannincncount').html("<%= number_with_delimiter(@emi_ncount, :delimiter => ',') %>");  <%# N for this output %>
$('#annincbycat').highcharts().series[0].setData(<%= @avg_pct_incomes.to_json.html_safe %>, true);

// Income by Age
$('#ageincomechart').highcharts().series[0].setData(<%= @nonmusic_inc_by_age.as_json %>, true);
$('#ageincomechart').highcharts().yAxis[0].removePlotLine('ageincomeplotline');
$('#ageincomechart').highcharts().yAxis[0].addPlotLine({
	id: 'ageincomeplotline',
  color: '#FF7D2C', 
  dashStyle: 'Dash',
  value: <%= @avg_emi %>,
  width: '2', 
  label: {
    text: 'Avg. EMI: <%= number_to_currency(@avg_emi, :precision=>0) %>',
    rotation: '0',
    verticalAlign: 'bottom',
    style: {
      textAlign: 'left',
      marginTop: '-1em',
      color: '#FF7D2C',
      fontSize: '.917em',
      fontWeight: 'bold'
    }
  }
});
$('#ageincomechart').highcharts().series[1].setData(<%= @music_inc_by_age.as_json %>, true);

// Income Trend
//$('#emincount').html("123,123,123");

//Other Music Income Sources
htmlstring ="<%= escape_javascript( render :partial => 'otherincbody') %>";
$('#otherincomebody').html(htmlstring);
htmlstring = "<%= escape_javascript( render :partial => 'abouthisgroup_body') %>";
$('#aboutthisgroup > span').html(htmlstring);
